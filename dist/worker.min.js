/**
 * Typescript-GrabCut
 * Author: EatMyGoose
 * Github: https://github.com/EatMyGoose/Typescript-GrabCut
 * Modified by Haskasu
 * Github: https://github.com/haskasu/Typescript-GrabCut
 */
var workerScope=self,requirejs,require,define;!function(global,setTimeout){var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.3.6",commentRegExp=/\/\*[\s\S]*?\*\/|([^:"'=]|^)\/\/.*$/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;function commentReplace(t,e){return e||""}function isFunction(t){return"[object Function]"===ostring.call(t)}function isArray(t){return"[object Array]"===ostring.call(t)}function each(t,e){var r;if(t)for(r=0;r<t.length&&(!t[r]||!e(t[r],r,t));r+=1);}function eachReverse(t,e){var r;if(t)for(r=t.length-1;-1<r&&(!t[r]||!e(t[r],r,t));r-=1);}function hasProp(t,e){return hasOwn.call(t,e)}function getOwn(t,e){return hasProp(t,e)&&t[e]}function eachProp(t,e){var r;for(r in t)if(hasProp(t,r)&&e(t[r],r))break}function mixin(t,e,r,n){return e&&eachProp(e,function(e,i){!r&&hasProp(t,i)||(!n||"object"!=typeof e||!e||isArray(e)||isFunction(e)||e instanceof RegExp?t[i]=e:(t[i]||(t[i]={}),mixin(t[i],e,r,n)))}),t}function bind(t,e){return function(){return e.apply(t,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(t){throw t}function getGlobal(t){if(!t)return t;var e=global;return each(t.split("."),function(t){e=e[t]}),e}function makeError(t,e,r,n){var i=new Error(e+"\nhttps://requirejs.org/docs/errors.html#"+t);return i.requireType=t,i.requireModules=n,r&&(i.originalError=r),i}if(void 0===define){if(void 0!==requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}void 0===require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(t,e,r,n){var i,o,a=defContextName;return isArray(t)||"string"==typeof t||(o=t,isArray(e)?(t=e,e=r,r=n):t=[]),o&&o.context&&(a=o.context),(i=getOwn(contexts,a))||(i=contexts[a]=req.s.newContext(a)),o&&i.configure(o),i.require(t,e,r)},req.config=function(t){return req(t)},req.nextTick=void 0!==setTimeout?function(t){setTimeout(t,4)}:function(t){t()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(t){req[t]=function(){var e=contexts[defContextName];return e.require[t].apply(e,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(t,e,r){var n=t.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return n.type=t.scriptType||"text/javascript",n.charset="utf-8",n.async=!0,n},req.load=function(t,e,r){var n,i=t&&t.config||{};if(isBrowser)return(n=req.createNode(i,e,r)).setAttribute("data-requirecontext",t.contextName),n.setAttribute("data-requiremodule",e),!n.attachEvent||n.attachEvent.toString&&n.attachEvent.toString().indexOf("[native code")<0||isOpera?(n.addEventListener("load",t.onScriptLoad,!1),n.addEventListener("error",t.onScriptError,!1)):(useInteractive=!0,n.attachEvent("onreadystatechange",t.onScriptLoad)),n.src=r,i.onNodeCreated&&i.onNodeCreated(n,i,e,r),currentlyAddingScript=n,baseElement?head.insertBefore(n,baseElement):head.appendChild(n),currentlyAddingScript=null,n;if(isWebWorker)try{setTimeout(function(){},0),importScripts(r),t.completeLoad(e)}catch(n){t.onError(makeError("importscripts","importScripts failed for "+e+" at "+r,n,[e]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(t){if(head||(head=t.parentNode),dataMain=t.getAttribute("data-main"))return mainScript=dataMain,cfg.baseUrl||-1!==mainScript.indexOf("!")||(mainScript=(src=mainScript.split("/")).pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0}),define=function(t,e,r){var n,i;"string"!=typeof t&&(r=e,e=t,t=null),isArray(e)||(r=e,e=null),!e&&isFunction(r)&&(e=[],r.length&&(r.toString().replace(commentRegExp,commentReplace).replace(cjsRequireRegExp,function(t,r){e.push(r)}),e=(1===r.length?["require"]:["require","exports","module"]).concat(e))),useInteractive&&(n=currentlyAddingScript||getInteractiveScript())&&(t||(t=n.getAttribute("data-requiremodule")),i=contexts[n.getAttribute("data-requirecontext")]),i?(i.defQueue.push([t,e,r]),i.defQueueMap[t]=!0):globalDefQueue.push([t,e,r])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}function newContext(t){var e,r,n,i,o,a={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},s={},u={},c={},h=[],l={},f={},p={},d=1,g=1;function v(t,e,r){var n,i,o,s,u,c,h,l,f,p,d=e&&e.split("/"),g=a.map,v=g&&g["*"];if(t&&(c=(t=t.split("/")).length-1,a.nodeIdCompat&&jsSuffixRegExp.test(t[c])&&(t[c]=t[c].replace(jsSuffixRegExp,"")),"."===t[0].charAt(0)&&d&&(t=d.slice(0,d.length-1).concat(t)),function(t){var e,r;for(e=0;e<t.length;e++)if("."===(r=t[e]))t.splice(e,1),e-=1;else if(".."===r){if(0===e||1===e&&".."===t[2]||".."===t[e-1])continue;0<e&&(t.splice(e-1,2),e-=2)}}(t),t=t.join("/")),r&&g&&(d||v)){t:for(o=(i=t.split("/")).length;0<o;o-=1){if(u=i.slice(0,o).join("/"),d)for(s=d.length;0<s;s-=1)if((n=getOwn(g,d.slice(0,s).join("/")))&&(n=getOwn(n,u))){h=n,l=o;break t}!f&&v&&getOwn(v,u)&&(f=getOwn(v,u),p=o)}!h&&f&&(h=f,l=p),h&&(i.splice(0,l,h),t=i.join("/"))}return getOwn(a.pkgs,t)||t}function m(t){isBrowser&&each(scripts(),function(e){if(e.getAttribute("data-requiremodule")===t&&e.getAttribute("data-requirecontext")===n.contextName)return e.parentNode.removeChild(e),!0})}function y(t){var e=getOwn(a.paths,t);if(e&&isArray(e)&&1<e.length)return e.shift(),n.require.undef(t),n.makeRequire(null,{skipMap:!0})([t]),!0}function M(t){var e,r=t?t.indexOf("!"):-1;return-1<r&&(e=t.substring(0,r),t=t.substring(r+1,t.length)),[e,t]}function b(t,e,r,i){var o,a,s,u,c=null,h=e?e.name:null,f=t,p=!0,m="";return t||(p=!1,t="_@r"+(d+=1)),c=(u=M(t))[0],t=u[1],c&&(c=v(c,h,i),a=getOwn(l,c)),t&&(c?m=r?t:a&&a.normalize?a.normalize(t,function(t){return v(t,h,i)}):-1===t.indexOf("!")?v(t,h,i):t:(c=(u=M(m=v(t,h,i)))[0],m=u[1],r=!0,o=n.nameToUrl(m))),{prefix:c,name:m,parentMap:e,unnormalized:!!(s=!c||a||r?"":"_unnormalized"+(g+=1)),url:o,originalName:f,isDefine:p,id:(c?c+"!"+m:m)+s}}function x(t){var e=t.id,r=getOwn(s,e);return r||(r=s[e]=new n.Module(t)),r}function w(t,e,r){var n=t.id,i=getOwn(s,n);!hasProp(l,n)||i&&!i.defineEmitComplete?(i=x(t)).error&&"error"===e?r(i.error):i.on(e,r):"defined"===e&&r(l[n])}function E(t,e){var r=t.requireModules,n=!1;e?e(t):(each(r,function(e){var r=getOwn(s,e);r&&(r.error=t,r.events.error&&(n=!0,r.emit("error",t)))}),n||req.onError(t))}function S(){globalDefQueue.length&&(each(globalDefQueue,function(t){var e=t[0];"string"==typeof e&&(n.defQueueMap[e]=!0),h.push(t)}),globalDefQueue=[])}function P(t){delete s[t],delete u[t]}function C(){var t,r,i=1e3*a.waitSeconds,c=i&&n.startTime+i<(new Date).getTime(),h=[],f=[],p=!1,d=!0;if(!e){if(e=!0,eachProp(u,function(t){var e=t.map,n=e.id;if(t.enabled&&(e.isDefine||f.push(t),!t.error))if(!t.inited&&c)y(n)?p=r=!0:(h.push(n),m(n));else if(!t.inited&&t.fetched&&e.isDefine&&(p=!0,!e.prefix))return d=!1}),c&&h.length)return(t=makeError("timeout","Load timeout for modules: "+h,null,h)).contextName=n.contextName,E(t);d&&each(f,function(t){!function t(e,r,n){var i=e.map.id;e.error?e.emit("error",e.error):(r[i]=!0,each(e.depMaps,function(i,o){var a=i.id,u=getOwn(s,a);!u||e.depMatched[o]||n[a]||(getOwn(r,a)?(e.defineDep(o,l[a]),e.check()):t(u,r,n))}),n[i]=!0)}(t,{},{})}),c&&!r||!p||!isBrowser&&!isWebWorker||o||(o=setTimeout(function(){o=0,C()},50)),e=!1}}function k(t){hasProp(l,t[0])||x(b(t[0],null,!0)).init(t[1],t[2])}function G(t,e,r,n){t.detachEvent&&!isOpera?n&&t.detachEvent(n,e):t.removeEventListener(r,e,!1)}function I(t){var e=t.currentTarget||t.srcElement;return G(e,n.onScriptLoad,"load","onreadystatechange"),G(e,n.onScriptError,"error"),{node:e,id:e&&e.getAttribute("data-requiremodule")}}function q(){var t;for(S();h.length;){if(null===(t=h.shift())[0])return E(makeError("mismatch","Mismatched anonymous define() module: "+t[t.length-1]));k(t)}n.defQueueMap={}}return i={require:function(t){return t.require?t.require:t.require=n.makeRequire(t.map)},exports:function(t){if(t.usingExports=!0,t.map.isDefine)return t.exports?l[t.map.id]=t.exports:t.exports=l[t.map.id]={}},module:function(t){return t.module?t.module:t.module={id:t.map.id,uri:t.map.url,config:function(){return getOwn(a.config,t.map.id)||{}},exports:t.exports||(t.exports={})}}},(r=function(t){this.events=getOwn(c,t.id)||{},this.map=t,this.shim=getOwn(a.shim,t.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0}).prototype={init:function(t,e,r,n){n=n||{},this.inited||(this.factory=e,r?this.on("error",r):this.events.error&&(r=bind(this,function(t){this.emit("error",t)})),this.depMaps=t&&t.slice(0),this.errback=r,this.inited=!0,this.ignore=n.ignore,n.enabled||this.enabled?this.enable():this.check())},defineDep:function(t,e){this.depMatched[t]||(this.depMatched[t]=!0,this.depCount-=1,this.depExports[t]=e)},fetch:function(){if(!this.fetched){this.fetched=!0,n.startTime=(new Date).getTime();var t=this.map;if(!this.shim)return t.prefix?this.callPlugin():this.load();n.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return t.prefix?this.callPlugin():this.load()}))}},load:function(){var t=this.map.url;f[t]||(f[t]=!0,n.load(this.map.id,t))},check:function(){if(this.enabled&&!this.enabling){var t,e,r=this.map.id,i=this.depExports,o=this.exports,a=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(a)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{o=n.execCb(r,a,i,o)}catch(e){t=e}else o=n.execCb(r,a,i,o);if(this.map.isDefine&&void 0===o&&((e=this.module)?o=e.exports:this.usingExports&&(o=this.exports)),t)return t.requireMap=this.map,t.requireModules=this.map.isDefine?[this.map.id]:null,t.requireType=this.map.isDefine?"define":"require",E(this.error=t)}else o=a;if(this.exports=o,this.map.isDefine&&!this.ignore&&(l[r]=o,req.onResourceLoad)){var s=[];each(this.depMaps,function(t){s.push(t.normalizedMap||t)}),req.onResourceLoad(n,this.map,s)}P(r),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else hasProp(n.defQueueMap,r)||this.fetch()}},callPlugin:function(){var t=this.map,e=t.id,r=b(t.prefix);this.depMaps.push(r),w(r,"defined",bind(this,function(r){var i,o,u,c=getOwn(p,this.map.id),h=this.map.name,l=this.map.parentMap?this.map.parentMap.name:null,f=n.makeRequire(t.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(r.normalize&&(h=r.normalize(h,function(t){return v(t,l,!0)})||""),w(o=b(t.prefix+"!"+h,this.map.parentMap,!0),"defined",bind(this,function(t){this.map.normalizedMap=o,this.init([],function(){return t},null,{enabled:!0,ignore:!0})})),void((u=getOwn(s,o.id))&&(this.depMaps.push(o),this.events.error&&u.on("error",bind(this,function(t){this.emit("error",t)})),u.enable()))):c?(this.map.url=n.nameToUrl(c),void this.load()):((i=bind(this,function(t){this.init([],function(){return t},null,{enabled:!0})})).error=bind(this,function(t){this.inited=!0,(this.error=t).requireModules=[e],eachProp(s,function(t){0===t.map.id.indexOf(e+"_unnormalized")&&P(t.map.id)}),E(t)}),i.fromText=bind(this,function(r,o){var s=t.name,u=b(s),c=useInteractive;o&&(r=o),c&&(useInteractive=!1),x(u),hasProp(a.config,e)&&(a.config[s]=a.config[e]);try{req.exec(r)}catch(r){return E(makeError("fromtexteval","fromText eval for "+e+" failed: "+r,r,[e]))}c&&(useInteractive=!0),this.depMaps.push(u),n.completeLoad(s),f([s],i)}),void r.load(t.name,f,i,a))})),n.enable(r,this),this.pluginMaps[r.id]=r},enable:function(){(u[this.map.id]=this).enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(t,e){var r,o,a;if("string"==typeof t){if(t=b(t,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[e]=t,a=getOwn(i,t.id))return void(this.depExports[e]=a(this));this.depCount+=1,w(t,"defined",bind(this,function(t){this.undefed||(this.defineDep(e,t),this.check())})),this.errback?w(t,"error",bind(this,this.errback)):this.events.error&&w(t,"error",bind(this,function(t){this.emit("error",t)}))}r=t.id,o=s[r],hasProp(i,r)||!o||o.enabled||n.enable(t,this)})),eachProp(this.pluginMaps,bind(this,function(t){var e=getOwn(s,t.id);e&&!e.enabled&&n.enable(t,this)})),this.enabling=!1,this.check()},on:function(t,e){var r=this.events[t];r||(r=this.events[t]=[]),r.push(e)},emit:function(t,e){each(this.events[t],function(t){t(e)}),"error"===t&&delete this.events[t]}},(n={config:a,contextName:t,registry:s,defined:l,urlFetched:f,defQueue:h,defQueueMap:{},Module:r,makeModuleMap:b,nextTick:req.nextTick,onError:E,configure:function(t){if(t.baseUrl&&"/"!==t.baseUrl.charAt(t.baseUrl.length-1)&&(t.baseUrl+="/"),"string"==typeof t.urlArgs){var e=t.urlArgs;t.urlArgs=function(t,r){return(-1===r.indexOf("?")?"?":"&")+e}}var r=a.shim,i={paths:!0,bundles:!0,config:!0,map:!0};eachProp(t,function(t,e){i[e]?(a[e]||(a[e]={}),mixin(a[e],t,!0,!0)):a[e]=t}),t.bundles&&eachProp(t.bundles,function(t,e){each(t,function(t){t!==e&&(p[t]=e)})}),t.shim&&(eachProp(t.shim,function(t,e){isArray(t)&&(t={deps:t}),!t.exports&&!t.init||t.exportsFn||(t.exportsFn=n.makeShimExports(t)),r[e]=t}),a.shim=r),t.packages&&each(t.packages,function(t){var e;e=(t="string"==typeof t?{name:t}:t).name,t.location&&(a.paths[e]=t.location),a.pkgs[e]=t.name+"/"+(t.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(s,function(t,e){t.inited||t.map.unnormalized||(t.map=b(e,null,!0))}),(t.deps||t.callback)&&n.require(t.deps||[],t.callback)},makeShimExports:function(t){return function(){var e;return t.init&&(e=t.init.apply(global,arguments)),e||t.exports&&getGlobal(t.exports)}},makeRequire:function(e,r){function o(a,u,c){var h,f;return r.enableBuildCallback&&u&&isFunction(u)&&(u.__requireJsBuild=!0),"string"==typeof a?isFunction(u)?E(makeError("requireargs","Invalid require call"),c):e&&hasProp(i,a)?i[a](s[e.id]):req.get?req.get(n,a,e,o):(h=b(a,e,!1,!0).id,hasProp(l,h)?l[h]:E(makeError("notloaded",'Module name "'+h+'" has not been loaded yet for context: '+t+(e?"":". Use require([])")))):(q(),n.nextTick(function(){q(),(f=x(b(null,e))).skipMap=r.skipMap,f.init(a,u,c,{enabled:!0}),C()}),o)}return r=r||{},mixin(o,{isBrowser:isBrowser,toUrl:function(t){var r,i=t.lastIndexOf("."),o=t.split("/")[0];return-1!==i&&(!("."===o||".."===o)||1<i)&&(r=t.substring(i,t.length),t=t.substring(0,i)),n.nameToUrl(v(t,e&&e.id,!0),r,!0)},defined:function(t){return hasProp(l,b(t,e,!1,!0).id)},specified:function(t){return t=b(t,e,!1,!0).id,hasProp(l,t)||hasProp(s,t)}}),e||(o.undef=function(t){S();var r=b(t,e,!0),i=getOwn(s,t);i.undefed=!0,m(t),delete l[t],delete f[r.url],delete c[t],eachReverse(h,function(e,r){e[0]===t&&h.splice(r,1)}),delete n.defQueueMap[t],i&&(i.events.defined&&(c[t]=i.events),P(t))}),o},enable:function(t){getOwn(s,t.id)&&x(t).enable()},completeLoad:function(t){var e,r,i,o=getOwn(a.shim,t)||{},u=o.exports;for(S();h.length;){if(null===(r=h.shift())[0]){if(r[0]=t,e)break;e=!0}else r[0]===t&&(e=!0);k(r)}if(n.defQueueMap={},i=getOwn(s,t),!e&&!hasProp(l,t)&&i&&!i.inited){if(!(!a.enforceDefine||u&&getGlobal(u)))return y(t)?void 0:E(makeError("nodefine","No define call for "+t,null,[t]));k([t,o.deps||[],o.exportsFn])}C()},nameToUrl:function(t,e,r){var i,o,s,u,c,h,l=getOwn(a.pkgs,t);if(l&&(t=l),h=getOwn(p,t))return n.nameToUrl(h,e,r);if(req.jsExtRegExp.test(t))u=t+(e||"");else{for(i=a.paths,s=(o=t.split("/")).length;0<s;s-=1)if(c=getOwn(i,o.slice(0,s).join("/"))){isArray(c)&&(c=c[0]),o.splice(0,s,c);break}u=o.join("/"),u=("/"===(u+=e||(/^data\:|^blob\:|\?/.test(u)||r?"":".js")).charAt(0)||u.match(/^[\w\+\.\-]+:/)?"":a.baseUrl)+u}return a.urlArgs&&!/^blob\:/.test(u)?u+a.urlArgs(t,u):u},load:function(t,e){req.load(n,t,e)},execCb:function(t,e,r,n){return e.apply(n,r)},onScriptLoad:function(t){if("load"===t.type||readyRegExp.test((t.currentTarget||t.srcElement).readyState)){interactiveScript=null;var e=I(t);n.completeLoad(e.id)}},onScriptError:function(t){var e=I(t);if(!y(e.id)){var r=[];return eachProp(s,function(t,n){0!==n.indexOf("_@r")&&each(t.depMaps,function(t){if(t.id===e.id)return r.push(n),!0})}),E(makeError("scripterror",'Script error for "'+e.id+(r.length?'", needed by: '+r.join(", "):'"'),t,[e.id]))}}}).require=n.makeRequire(),n}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState||eachReverse(scripts(),function(t){if("interactive"===t.readyState)return interactiveScript=t}),interactiveScript}}(this,"undefined"==typeof setTimeout?void 0:setTimeout);var __extends=this&&this.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("Utility",["require","exports","Collections/Dictionary"],function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UniqueRandom=e.Fill2DRect=e.HashItems=e.Sum=e.Max=e.Swap=e.Zip=e.Fill2DObj=e.FillObj=e.Memset=e.Fill=e.Range=e.PerfectlyDivisible=e.Clamp=void 0,e.Clamp=function(t,e,r){return t>e?e:t<r?r:t},e.PerfectlyDivisible=function(t,e){var r=t/e;return Math.floor(r)==r},e.Range=function(t,e){for(var r=new Array(e-t),n=0,i=t;i<e;i+=1)r[n++]=i;return r},e.Fill=function(t,e){for(var r=new Array(t),n=0;n<r.length;n++)r[n]=e;return r},e.Memset=function(t,e){for(var r=0;r<t.length;r++)t[r]=e},e.FillObj=function(t,e){for(var r=new Array(t),n=0;n<r.length;n++)r[n]=e();return r},e.Fill2DObj=function(t,e,r){for(var n=new Array(t),i=0;i<t;i++){for(var o=new Array(e),a=0;a<e;a++)o[a]=r();n[i]=o}return n},e.Zip=function(t,e,r){if(t.length!=e.length)throw new Error("Zip: arrays of different length: 1st: "+t.length+"  2nd: "+e.length);for(var n=new Array(t.length),i=0;i<n.length;i++)n[0]=r(t[i],e[i]);return n},e.Swap=function(t,e,r){var n=t[e];t[e]=t[r],t[r]=n},e.Max=function(t){for(var e=t[0],r=0;r<t.length;r++)e=Math.max(e,t[r]);return e},e.Sum=function(t){for(var e=0,r=0;r<t.length;r++)e+=t[r];return e},e.HashItems=function(t,e){for(var n=new r.ObjectDict,i=0;i<t.length;i++){var o=t[i],a=e(o);n.ContainsKey(a)||n.Set(a,o)}return n},e.Fill2DRect=function(t,e,r,n,i,o){for(var a=r+i,s=n+o,u=n;u<s;u++)for(var c=r;c<a;c++)t[u][c]=e},e.UniqueRandom=function(t,e){if(t>e)throw new Error("UniqueRandom: nNumbers must be smaller than upperInclusive");for(var n=new r.ObjectDict,i=[];i.length<t;){var o=Math.floor(Math.random()*e);n.ContainsKey(o)||(i.push(o),n.Set(o,!0))}return i}}),define("Collections/Dictionary",["require","exports","Utility"],function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VisitedArray=e.ObjectDict=void 0;var n=function(){function t(){this.hashtable={}}return t.prototype.ContainsKey=function(t){return this.hashtable.hasOwnProperty(t)},t.prototype.Remove=function(t){delete this.hashtable[t]},t.prototype.Get=function(t){return this.hashtable[t]},t.prototype.Set=function(t,e){this.hashtable[t]=e},t.prototype.ToList=function(){var t=this;return Object.keys(this.hashtable).map(function(e){return[e,t.hashtable[e]]})},t}();e.ObjectDict=n;var i=function(){function t(t){this.visited=r.Fill(t,-1),this.token=0}return t.prototype.UpdateToken=function(){return this.token>=2147483647&&(this.token=1,r.Memset(this.visited,0)),this.token+=1,[this.visited,this.token]},t}();e.VisitedArray=i}),define("Collections/Queue",["require","exports","Collections/Dictionary","Utility"],function(t,e,r,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LabelledCircularQueue=e.CircularBufferQueue=e.DoubleStackQueue=void 0;var i=function(){function t(){this.incoming=[],this.outgoing=[],this.size=0}return t.prototype.Shift=function(){for(;this.incoming.length>0;){var t=this.incoming.pop();this.outgoing.push(t)}},t.prototype.Enqueue=function(t){this.size+=1,this.incoming.push(t)},t.prototype.Peek=function(){return 0==this.outgoing.length&&this.Shift(),this.outgoing[this.outgoing.length-1]},t.prototype.Dequeue=function(){return 0==this.outgoing.length&&this.Shift(),this.size-=1,this.outgoing.pop()},t.prototype.Count=function(){return this.size},t}();e.DoubleStackQueue=i;var o=function(){function t(t){void 0===t&&(t=32),this.head=0,this.tail=0,this.count=0,this.buffer=new Array(t)}return t.prototype.Resize=function(t,e){for(var r=new Array(e),n=0;n<t;n++){var i=(this.tail+n)%t;r[n]=this.buffer[i]}this.buffer=r,this.tail=0,this.head=this.count},t.prototype.Enqueue=function(t){this.count++,this.buffer[this.head]=t,this.head=this.head+1,this.head>=this.buffer.length&&(this.head=0),this.head==this.tail&&this.Resize(this.buffer.length,2*this.buffer.length)},t.prototype.Peek=function(){return this.buffer[this.tail]},t.prototype.Dequeue=function(){this.count-=1;var t=this.buffer[this.tail];return this.tail++,this.tail>=this.buffer.length&&(this.tail=0),t},t.prototype.Count=function(){return this.count},t}();e.CircularBufferQueue=o;var a=function(t){function e(e){void 0===e&&(e=32);var i=t.call(this,e)||this;return i.skip=n.Fill(e,!1),i.indices=new r.ObjectDict,i}return __extends(e,t),e.prototype.ResizeBuffers=function(t,e){for(var n=new Array(e),i=new Array(e),o=new r.ObjectDict,a=0,s=0;s<t;s++){var u=(this.tail+s)%t;if(!this.skip[u]){var c=this.buffer[u];i[a]=c,n[a]=!1,o.Set(c,a),a++}}this.indices=o,this.buffer=i,this.skip=n,this.tail=0,this.head=this.count},e.prototype.Contains=function(t){return this.indices.ContainsKey(t)},e.prototype.Remove=function(t){this.count--;var e=this.indices.Get(t);if(!this.indices.ContainsKey(t))throw new Error("queue does not contain element "+t);this.indices.Remove(t),this.skip[e]=!0},e.prototype.Enqueue=function(t){if(this.count++,this.skip[this.head]=!1,this.buffer[this.head]=t,this.indices.ContainsKey(t))throw new Error("Queue contains duplicate "+t);this.indices.Set(t,this.head),this.head++,this.head>=this.buffer.length&&(this.head=0),this.head==this.tail&&this.ResizeBuffers(this.buffer.length,2*this.buffer.length)},e.prototype.MoveToValid=function(){for(;this.skip[this.tail];)this.tail=(this.tail+1)%this.skip.length},e.prototype.Peek=function(){return this.MoveToValid(),t.prototype.Peek.call(this)},e.prototype.Dequeue=function(){this.MoveToValid();var e=t.prototype.Dequeue.call(this);if(!this.indices.ContainsKey(e))throw new Error("queue does not contain element "+e);return this.indices.Remove(e),e},e}(o);e.LabelledCircularQueue=a}),define("FlowNetworkSolver",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}),define("Matrix",["require","exports"],function(t,e){"use strict";function r(t){return t.length}function n(t){return t[0].length}function i(t,e){for(var r=new Array(t),n=0;n<t;n++){for(var i=new Array(e),o=0;o<e;o++)i[o]=0;r[n]=i}return r}function o(t){return[r(t),n(t)]}function a(t){return r(t)==n(t)}function s(t){return t}function u(t,e){for(var r=[t.length,e[0].length],n=r[0],o=r[1],a=i(n,o),s=t[0].length,u=0;u<n;u++)for(var c=0;c<o;c++){for(var h=0,l=0;l<s;l++)h+=t[u][l]*e[l][c];a[u][c]=h}return a}function c(t){for(var e=o(t),r=e[0],n=e[1],a=i(n,r),s=0;s<r;s++)for(var u=0;u<n;u++)a[u][s]=t[s][u];return a}function h(t,e){for(var r=o(e),n=r[0],a=r[1],s=i(n,a),u=0;u<n;u++)for(var c=0;c<a;c++)s[u][c]=t*e[u][c];return s}function l(t,e){for(var r=o(t),n=r[0],i=r[1],a=0;a<n;a++)for(var s=0;s<i;s++)t[a][s]+=e[a][s]}function f(t,e){for(var r=o(t),n=r[0],a=r[1],s=i(n,a),u=0;u<n;u++)for(var c=0;c<a;c++)s[u][c]=t[u][c]-e[u][c];return s}function p(t){if(!a(t)){var e=o(t),n=e[0],i=e[1];throw new Error("Determinant: parameter is a non square matrix - rows:"+n+" colums:"+i)}var s=r(t);switch(s){case 1:return t[0][0];case 2:return t[0][0]*t[1][1]-t[0][1]*t[1][0];case 3:var u=t[1][1]*t[2][2]-t[1][2]*t[2][1],c=t[1][0]*t[2][2]-t[1][2]*t[2][0],h=t[1][0]*t[2][1]-t[1][1]*t[2][0];return t[0][0]*u-t[0][1]*c+t[0][2]*h;default:for(var l=0,f=!0,g=0;g<s;g++){var v=d(t,0,g);l+=(f?1:-1)*t[0][g]*p(v),f=!f}return l}}function d(t,e,r){for(var n=o(t),i=n[0],a=n[1],u=[],c=0;c<i;c++)if(c!=e){for(var h=[],l=0;l<a;l++)l!=r&&h.push(t[c][l]);u.push(h)}return s(u)}function g(t){for(var e=o(t),r=e[0],n=e[1],a=i(r,n),s=0;s<r;s++)for(var u=0==(1&s),c=0;c<n;c++){var h=d(t,s,c),l=u?1:-1;u=!u,a[s][c]=l*p(h)}return a}function v(t){var e=o(t);e[0];return 1==e[1]}function m(t){var e=o(t),r=e[0];e[1];return 1==r}function y(t){return v(t)||m(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.IsVector=e.IsRowVector=e.IsColumnVector=e.MaxElement=e.Inverse=e.Cofactors=e.SubMatrix=e.Determinant=e.MeanAndCovarianceFromLabelledData=e.MeanAndCovariance=e.AddScalar=e.Sub=e.AddInPlace=e.Add=e.Scale=e.Transpose=e.Mul=e.FromArray=e.IsSquare=e.Dimensions=e.NormSquare=e.Identity=e.Norm=e.CreateMatrix=e.Columns=e.Rows=e.RandomFill=e.Any=e.OfDimensions=e.Clone=e.Print=void 0,e.Print=function(t){return"["+t.map(function(t){return"["+t.join(",")+"]"}).join("\n")+"]"},e.Clone=function(t){for(var e=o(t),r=e[0],n=(e[1],new Array(r)),i=0;i<r;i++)n[i]=t[i].slice(0);return s(n)},e.OfDimensions=function(t,e,r){return t.length==e&&t[0].length==r},e.Any=function(t,e){for(var r=o(t),n=r[0],i=r[1],a=0;a<n;a++)for(var s=0;s<i;s++)if(t[a][s],e(s))return!0;return!1},e.RandomFill=function(t,e){for(var r=o(t),n=r[0],a=r[1],s=i(n,a),u=0;u<n;u++)for(var c=0;c<a;c++){var h=t[u][c],l=e[u][c];s[u][c]=Math.random()*(l-h)+h}return s},e.Rows=r,e.Columns=n,e.CreateMatrix=i,e.Norm=function(t){for(var e=o(t),r=e[0],n=e[1],i=r*n,a=0,s=0;s<r;s++)for(var u=0;u<n;u++)a+=t[s][u]*t[s][u];return Math.pow(a,1/i)},e.Identity=function(t){for(var e=i(t,t),r=0;r<t;r++)e[r][r]=1;return e},e.NormSquare=function(t){for(var e=o(t),r=e[0],n=e[1],i=0,a=0;a<r;a++)for(var s=0;s<n;s++)i+=t[a][s]*t[a][s];return i},e.Dimensions=o,e.IsSquare=a,e.FromArray=s,e.Mul=u,e.Transpose=c,e.Scale=h,e.Add=function(t,e){for(var r=o(t),n=r[0],a=r[1],s=i(n,a),u=0;u<n;u++)for(var c=0;c<a;c++)s[u][c]=t[u][c]+e[u][c];return s},e.AddInPlace=l,e.Sub=f,e.AddScalar=function(t,e){for(var r=o(e),n=r[0],a=r[1],s=i(n,a),u=0;u<n;u++)for(var c=0;c<a;c++)s[u][c]=e[u][c]+t;return s},e.MeanAndCovariance=function(t){if(!y(t[0]))throw Error("MeanAndCovariance: Vector input required");for(var e=o(t[0]),r=e[0],n=e[1],a=t.length,s=i(r,n),p=0;p<t.length;p++)l(s,t[p]);var d=h(1/a,s),g=Math.max(r,n),v=i(g,g);for(p=0;p<t.length;p++){var m=f(t[p],d);l(v,u(m,c(m)))}return{mean:d,covariance:h(1/a,v)}},e.MeanAndCovarianceFromLabelledData=function(t,e,r){if(!y(r[0]))throw Error("MeanAndCovariance: Vector input required");for(var n=o(r[0]),a=n[0],s=n[1],p=0,d=i(a,s),g=0;g<r.length;g++)e[g]==t&&(l(d,r[g]),p++);var v=h(1/p,d),m=Math.max(a,s),M=i(m,m);for(g=0;g<r.length;g++)if(e[g]==t){var b=f(r[g],v);l(M,u(b,c(b)))}return{mean:v,covariance:h(1/p,M)}},e.Determinant=p,e.SubMatrix=d,e.Cofactors=g,e.Inverse=function(t){if(!a(t)){var e=o(t),n=e[0],s=e[1];throw new Error("Matrix Inverse: parameter is a non square matrix - rows:"+n+" colums:"+s)}if(1==r(t)){var u=i(1,1);return u[0][0]=1/t[0][0],u}return h(1/p(t),c(g(t)))},e.MaxElement=function(t){for(var e=o(t),r=e[0],n=e[1],i=t[0][0],a=0;a<r;a++)for(var s=0;s<n;s++)i=Math.max(i,t[a][s]);return i},e.IsColumnVector=v,e.IsRowVector=m,e.IsVector=y}),define("ConvergenceChecker",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ConvergenceChecker=void 0;var r=function(){function t(t,e){this.maxIter=0,this.iterCount=0,this.lastObjFnValue=null,this.minChange=1,this.maxIter=e,this.minChange=t/100}return t.prototype.hasConverged=function(t,e){if(void 0===e&&(e=-1),this.iterCount=e<0?this.iterCount+1:e,this.iterCount>=this.maxIter)return!0;if(null==this.lastObjFnValue)return this.lastObjFnValue=t,!1;var r=Math.abs(t-this.lastObjFnValue),n=Math.abs(t);return this.lastObjFnValue=t,0!=n&&r/n<this.minChange},t.prototype.getCurrentIter=function(){return this.iterCount},t}();e.ConvergenceChecker=r}),define("V3",["require","exports","Matrix"],function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isV3=e.DiffNormSquare=e.Norm=e.NormSquare=e.AddInPlace=e.SubInPlace=e.Sub=void 0,e.Sub=function(t,e){var r=new Array(3);return r[0]=[t[0][0]-e[0][0]],r[1]=[t[1][0]-e[1][0]],r[2]=[t[2][0]-e[2][0]],r},e.SubInPlace=function(t,e){t[0][0]-=e[0][0],t[1][0]-=e[1][0],t[2][0]-=e[2][0]},e.AddInPlace=function(t,e){t[0][0]+=e[0][0],t[1][0]+=e[1][0],t[2][0]+=e[2][0]},e.NormSquare=function(t){var e=t[0][0],r=t[1][0],n=t[2][0];return e*e+r*r+n*n},e.Norm=function(t){var e=t[0][0],r=t[1][0],n=t[2][0];return Math.sqrt(e*e+r*r+n*n)},e.DiffNormSquare=function(t,e){var r=t[0][0]-e[0][0],n=t[1][0]-e[1][0],i=t[2][0]-e[2][0];return r*r+n*n+i*i},e.isV3=function(t){return r.IsColumnVector(t)&&3==r.Rows(t)}}),define("KMeans",["require","exports","Utility","Matrix","Collections/Dictionary","ConvergenceChecker","V3"],function(t,e,r,n,i,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Fit=e.Initializer=e.KMeansResult=void 0;var s,u=function(){function t(t,e){this.meanDist=-1,this.clusters=t,this.means=e}return t.prototype.MeanDistanceToCluster=function(){if(this.meanDist>=0)return this.meanDist;var t=r.Sum(this.clusters.map(function(t){return t.length})),e=this.means[0];var i=a.isV3(e)?function(e,r){var n=0;return r.forEach(function(t,r){for(var i=e[r],o=0;o<t.length;o++)n+=Math.sqrt(a.DiffNormSquare(t[o],i))}),n/t}:function(e,r){var i=0;return r.forEach(function(t,r){for(var o=e[r],a=0;a<t.length;a++){var s=n.Sub(t[a],o);i+=n.Norm(s)}}),i/t};return this.meanDist=i(this.means,this.clusters),this.meanDist},t}();function c(t,e){var i=e.length,o=r.FillObj(i,function(){return[]});return(a.isV3(t[0])?function(t,e,r){for(var n=0;n<e.length;n++){for(var i=[Number.MAX_VALUE,-1],o=i[0],s=i[1],u=0;u<r.length;u++){var c=a.DiffNormSquare(e[n],r[u]);c<o&&(o=c,s=u)}t[s].push(e[n])}return t}:function(t,e,r){for(var i=0;i<e.length;i++){for(var o=[Number.MAX_VALUE,-1],a=o[0],s=o[1],u=0;u<r.length;u++){var c=n.Sub(e[i],r[u]),h=n.NormSquare(c);h<a&&(a=h,s=u)}t[s].push(e[i])}return t})(o,t,e)}e.KMeansResult=u,function(t){t[t.random=0]="random",t[t.KMeansPlusPlus=1]="KMeansPlusPlus"}(s=e.Initializer||(e.Initializer={})),e.Fit=function(t,e,h,l,f){var p;void 0===h&&(h=100),void 0===l&&(l=1),void 0===f&&(f=s.KMeansPlusPlus);var d,g=n.Dimensions(t[0]),v=g[0],m=g[1],y=a.isV3(t[0]);if(f==s.random){var M=(d=r.UniqueRandom(e,t.length-1).map(function(e){return t[e]})).map(function(t){var e=n.Sub(d[0],t);return n.NormSquare(e)});r.Sum(M)}else(p=function(t,e){var r=new i.ObjectDict,o=Math.floor(Math.random()*(e.length-1));r.Set(o,!0);for(var s=[e[o]],u=new Array(e.length),c=new Array(e.length),h=a.isV3(e[0])?a.DiffNormSquare:function(t,e){return n.NormSquare(n.Sub(t,e))};s.length<t;){for(var l=0;l<e.length;l++){for(var f=Number.MAX_VALUE,p=0;p<s.length;p++){var d=h(e[l],s[p]);d<f&&(f=d)}u[l]=f}var g=0;for(l=0;l<u.length;l++)g+=u[l],c[l]=g;var v=c[c.length-1];if(0==v){var m=new Array(t);for(l=0;l<t;l++)m[l]=e[o];return[!1,m]}var y=0;do{var M=Math.random()*v;for(l=0;l<c.length;l++)if(c[l]>=M){y=l;break}}while(r.ContainsKey(y));r.Set(y,!0),s.push(e[y])}return[!0,s]}(e,t))[0],d=p[1];var b,x=new o.ConvergenceChecker(l,h),w=c(t,d),E=function(){var e=y?a.AddInPlace:n.AddInPlace;d=w.map(function(t){for(var r=n.CreateMatrix(v,m),i=0;i<t.length;i++)e(r,t[i]);return n.Scale(1/t.length,r)}),w=c(t,d),b=new u(w,d)};do{E()}while(!x.hasConverged(b.MeanDistanceToCluster()));return console.log("KMeans exited at "+x.getCurrentIter()),b}}),define("GMMCluster",["require","exports","Matrix"],function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.V3Cluster=e.ClusterFactory=e.Cluster=void 0;var n=function(){return function(t,e,n){if(this.pi=t,this.mean=e,Math.abs(r.Determinant(n))<1e-7){var i=r.Rows(n),o=r.Scale(1e-7,r.Identity(i));n=r.Add(n,o)}this.covariance=n,this.covarianceDet=r.Determinant(n),this.covarianceInv=r.Inverse(n),this.dim=Math.max.apply(Math,r.Dimensions(e));var a=Math.sqrt(Math.pow(2*Math.PI,this.dim)*Math.abs(this.covarianceDet));this.coeff=this.pi*(1/a);var s=[this.dim,this.pi,this.covarianceDet].filter(function(t){return isNaN(t)}).length>0,u=[this.mean,this.covariance,this.covarianceInv].filter(function(t){return r.Any(t,function(t){return isNaN(t)})}).length>0;if(s||u)throw console.log({dim:this.dim,pi:this.pi,covarianceDet:this.covarianceDet}),console.log({mean:this.mean,covariance:this.covariance,covarianceInv:this.covarianceInv}),new Error("NaN in GMM cluster")}}(),i=function(){function t(t,e,r){this.params=new n(t,e,r)}return t.prototype.Likelihood=function(t){var e=r.Sub(t,this.params.mean),n=r.Transpose(e),i=-.5*r.Mul(r.Mul(n,this.params.covarianceInv),e)[0][0],o=this.params.coeff*Math.exp(i);return o=isFinite(o)?o:Number.MAX_SAFE_INTEGER},t}();e.Cluster=i,e.ClusterFactory=function(t,e,n){return 3==Math.max.apply(Math,r.Dimensions(e))?new o(t,e,n):new i(t,e,n)};var o=function(){function t(t,e,r){this.params=new n(t,e,r)}return t.prototype.Likelihood=function(t){var e,n,i,o,a,s,u,c,h,l,f,p=r.Sub(t,this.params.mean),d=-.5*(e=p,n=this.params.covarianceInv,i=e[0][0],o=e[1][0],a=e[2][0],s=n[0],u=n[1],c=n[2],h=i*s[0]+o*u[0]+a*c[0],l=i*s[1]+o*u[1]+a*c[1],f=i*s[2]+o*u[2]+a*c[2],h*i+l*o+f*a),g=this.params.coeff*Math.exp(d);return g=isFinite(g)?g:Number.MAX_SAFE_INTEGER},t}();e.V3Cluster=o}),define("GMM",["require","exports","Utility","Matrix","KMeans","ConvergenceChecker","GMMCluster","Progress"],function(t,e,r,n,i,o,a,s){"use strict";var u;Object.defineProperty(e,"__esModule",{value:!0}),e.GMM=e.GMMResult=e.Initializer=void 0,function(t){t[t.random=0]="random",t[t.KMeansPlusPlus=1]="KMeansPlusPlus"}(u=e.Initializer||(e.Initializer={}));var c=function(){function t(t){this.likelihoods=t}return t.prototype.TotalLikelihood=function(){return r.Sum(this.likelihoods)},t.prototype.Normalized=function(){var t=r.Max(this.likelihoods);return this.likelihoods.map(function(e){return e/t})},t}();e.GMMResult=c;var h=function(){function t(){}return t.prototype.Fit=function(e,r,a,c,h){if(void 0===a&&(a=u.KMeansPlusPlus),void 0===c&&(c=20),void 0===h&&(h=1),!n.IsVector(e[0]))throw new Error("GMM.Fit: Error, data points need to be vectors (ideally column vectors)");var f,p=e;switch(n.IsRowVector(e[0])&&(p=e.map(function(t){return n.Transpose(t)})),console.time("GMM:Init Clusters"),a){case u.random:f=this.RandomInit(p,r);break;case u.KMeansPlusPlus:console.time("KMeans");var d=i.Fit(p,r,20,1,i.Initializer.KMeansPlusPlus).clusters.filter(function(t){return t.length>0});console.timeEnd("KMeans"),s.progress.STEP.KMeans.advance(),console.time("Points2GMM"),f=d.map(function(e){var r=t.Points2GMMCluster(e,p.length);return s.progress.STEP.Points2GMM.advance(1/d.length),r}),console.timeEnd("Points2GMM")}console.timeEnd("GMM:Init Clusters"),console.log("GMM:EM-start");var g,v=new o.ConvergenceChecker(h,c);do{f=l(p,f),g=t.LogLikelihood(p,f),console.log("Iteration:"+v.getCurrentIter()+", logProb:"+g),s.progress.reset}while(!v.hasConverged(g));this.clusters=f},t.prototype.Predict=function(t){for(var e=n.IsColumnVector(t)?t:n.Transpose(t),r=new Array(this.clusters.length),i=0;i<r.length;i++)r[i]=this.clusters[i].Likelihood(e);return new c(r)},t.prototype.RandomInit=function(t,e){var i=n.Rows(t[0]),o=1/e;return r.UniqueRandom(e,t.length-1).map(function(e){return a.ClusterFactory(o,t[e],n.Identity(i))})},t.labelledDataToGMMs=function(e,i,o,s,u,c){var h=new t,l=new t,f=function(t,e){var i=r.Sum(e);return t.map(function(t,r){var o=e[r]/i,s=n.MeanAndCovarianceFromLabelledData(t,u,c);return a.ClusterFactory(o,s.mean,s.covariance)})};return h.clusters=f(e,i),l.clusters=f(o,s),[h,l]},t.PreclusteredDataToGMM=function(e){var n=new t,i=r.Sum(e.map(function(t){return t.length}));return n.clusters=e.map(function(e){return t.Points2GMMCluster(e,i)}),n},t.Points2GMMCluster=function(t,e){if(0==t.length)throw new Error("GMM cluster cannot be empty");var r=t.length/e,i=n.MeanAndCovariance(t);return a.ClusterFactory(r,i.mean,i.covariance)},t.LogLikelihood=function(t,e){for(var r=0,n=0;n<t.length;n++){for(var i=0,o=0;o<e.length;o++)i+=e[o].Likelihood(t[n]);r+=Math.log(i)}return r},t}();function l(t,e){var i=function(t,e){for(var r=0;r<t.length;r++)t[r]<e&&(t[r]=e)};if(0==t.length)throw new Error("Empty data set");console.time("EM-init");var o=t.length,u=n.Rows(t[0]),c=e.length,h=n.CreateMatrix(c,o),l=r.Fill(t.length,0);console.time("EM-Likelihood-eval");for(var v=0;v<c;v++)for(var m=e[v],y=0;y<o;y++){var M=m.Likelihood(t[y]);if(isNaN(M))throw console.log(m),new Error("NaN");h[v][y]=M,l[y]+=M}console.timeEnd("EM-Likelihood-eval"),s.progress.STEP.EMLikelihoodEval.advance();i(l,1e-9);var b=n.CreateMatrix(c,o),x=r.Fill(c,0);for(v=0;v<c;v++)for(y=0;y<o;y++){var w=h[v][y]/l[y];b[v][y]=w,x[v]+=w}i(x,1e-9),console.timeEnd("EM-init");var E=r.FillObj(c,function(){return n.CreateMatrix(u,1)});console.time("EM-Resp-Sum"),(3==u?p:f)(t,E,b,c);for(v=0;v<c;v++)if(n.Any(E[v],function(t){return isNaN(t)}))throw new Error("cluster sum NaN");console.timeEnd("EM-Resp-Sum"),s.progress.STEP.EMRespSum.advance();var S=E.map(function(t,e){return n.Scale(1/x[e],t)}),P=x.map(function(t){return t/o}),C=r.FillObj(c,function(){return n.CreateMatrix(u,u)});console.time("EM-cov-cal"),(3==u?g:d)(t,c,S,b,C),console.timeEnd("EM-cov-cal"),s.progress.STEP.EMCovCal.advance();var k=C.map(function(t,e){return n.Scale(1/x[e],t)});return S.map(function(t,e){return a.ClusterFactory(P[e],S[e],k[e])})}function f(t,e,r,i){for(var o=0;o<i;o++)for(var a=0;a<t.length;a++){var s=n.Scale(r[o][a],t[a]);n.AddInPlace(e[o],s)}}function p(t,e,r,n){for(var i=0;i<n;i++)for(var o=0;o<t.length;o++){var a=e[i],s=r[i][o],u=t[o];a[0][0]+=s*u[0][0],a[1][0]+=s*u[1][0],a[2][0]+=s*u[2][0]}}function d(t,e,r,i,o){for(var a=0;a<e;a++)for(var s=0;s<t.length;s++){var u=n.Sub(t[s],r[a]),c=n.Transpose(u),h=n.Scale(i[a][s],n.Mul(u,c));n.AddInPlace(o[a],h)}}function g(t,e,r,n,i){for(var o=0;o<e;o++)for(var a=0;a<t.length;a++){var s=t[a],u=r[o],c=s[0][0]-u[0][0],h=s[1][0]-u[1][0],l=s[2][0]-u[2][0],f=n[o][a],p=i[o],d=p[0];d[0]+=f*c*c,d[1]+=f*c*h,d[2]+=f*c*l;var g=p[1];g[0]+=f*h*c,g[1]+=f*h*h,g[2]+=f*h*l;var v=p[2];v[0]+=f*l*c,v[1]+=f*l*h,v[2]+=f*l*l}}e.GMM=h}),define("GrabCut",["require","exports","GMM","BKGraph","Matrix","Utility","ConvergenceChecker","V3","Progress"],function(t,e,r,n,i,o,a,s,u){"use strict";var c;Object.defineProperty(e,"__esModule",{value:!0}),e.GrabCut=e.Trimap=void 0,function(t){t[t.Background=0]="Background",t[t.Foreground=1]="Foreground",t[t.Unknown=2]="Unknown"}(c=e.Trimap||(e.Trimap={}));var h=function(){function t(t,e,n){this.fgGMM=new r.GMM,this.bgGMM=new r.GMM,this.height=n,this.width=e;var i=e*n;this.matte=new Uint8Array(i),this.trimap=new Uint8Array(i),this.flattenedImg=t}return t.prototype.SetTrimap=function(t,e,r){for(var n=0;n<r;n++)for(var i=0;i<e;i++){var o=l(n,i,e);this.trimap[o]=t[n][i]}},t.prototype.BeginCrop=function(e){console.log(e);for(var n=0;n<this.trimap.length;n++)this.matte[n]=this.trimap[n]==c.Background?c.Background:c.Foreground;var i=t.SegregatePixels(this.flattenedImg,this.matte,0,0,this.height,this.width),o=i[0],a=i[1];console.time("Grabcut-GM"),this.fgGMM.Fit(o,e.nFGClusters,r.Initializer.KMeansPlusPlus,5,1),this.bgGMM.Fit(a,e.nBGClusters,r.Initializer.KMeansPlusPlus,5,1),console.timeEnd("Grabcut-GM"),u.progress.STEP.KMeans.advanceMax(),u.progress.STEP.Points2GMM.advanceMax(),u.progress.STEP.EMLikelihoodEval.advanceMax(),u.progress.STEP.EMRespSum.advanceMax(),u.progress.STEP.EMCovCal.advanceMax(),this.RunIterations(e.maxIterations,e.tolerance,e.cohesionFactor)},t.prototype.RunIterations=function(e,i,s){var c,h=new n.BKNetwork,l=n.BKMaxflow;console.time("Grabcut-Pixel Graph");var f=t.GeneratePixel2PixelGraph(this.flattenedImg,this.width,this.height,h,s),p=f[0],d=f[1],g=t.InitSourceAndSink(p,this.width,this.height),v=g[0],m=g[1];console.timeEnd("Grabcut-Pixel Graph");var y,M=new a.ConvergenceChecker(i,e),b=o.Fill(this.width*this.height,0);console.time("Grabcut-Graph Cut");do{console.log("iter:"+M.getCurrentIter()),console.time("Grabcut-Graph init");var x=function(t,e){for(var r=[],n=[],i=0;i<t.length;i++)e[i]>0&&(r.push(t[i]),n.push(e[i]));return[r,n]};console.time("Graphcut-Graph GMM-recomputation");var w=t.LabelPixels(this.matte,this.height,this.width,this.fgGMM,this.bgGMM,this.flattenedImg,b),E=w[0],S=w[1],P=w[2],C=w[3],k=x(E,S),G=k[0],I=k[1],q=x(P,C),_=q[0],D=q[1];c=r.GMM.labelledDataToGMMs(G,I,_,D,b,this.flattenedImg),this.fgGMM=c[0],this.bgGMM=c[1],console.timeEnd("Graphcut-Graph GMM-recomputation"),u.progress.STEP.GrabcutGMMRecomputation.advance(),console.log("fg clusters:"+this.fgGMM.clusters.length+", bg clusters:"+this.bgGMM.clusters.length),console.time("Grabcut-Graph source sink update"),t.UpdateSourceAndSink(p,d,this.fgGMM,this.bgGMM,this.flattenedImg,this.width,this.height,this.trimap,v,m),console.timeEnd("Grabcut-Graph source sink update"),u.progress.STEP.GrabcutGraphSourceSinkUpdate.advance(),console.time("Grabcut-Graph flow reset"),p.ResetFlow(),console.timeEnd("Grabcut-Graph flow reset"),u.progress.STEP.GrabcutGraphFlowReset.advance(),console.timeEnd("Grabcut-Graph init"),console.time("Grabcut-Graph maxflow"),console.log("max flow");var A=l(v,m,p);console.timeEnd("Grabcut-Graph maxflow"),console.time("Grabcut-Graph cut"),console.log("cut");var F=A.GetSourcePartition();t.UpdateMatte(this.matte,this.trimap,F),y=A.GetMaxFlow(),console.timeEnd("Grabcut-Graph cut"),u.progress.STEP.GrabcutGraphCut.advance(),console.log("Energy: "+y)}while(!M.hasConverged(y));console.timeEnd("Grabcut-Graph Cut"),u.progress.STEP.GrabcutGMMRecomputation.advanceMax(),u.progress.STEP.GrabcutGraphSourceSinkUpdate.advanceMax(),u.progress.STEP.GrabcutGraphFlowReset.advanceMax(),u.progress.STEP.GrabcutGraphMaxFlow.advanceMax(),u.progress.STEP.GrabcutGraphCut.advanceMax()},t.prototype.GetAlphaMask=function(){for(var t,e,r=i.CreateMatrix(this.height,this.width),n=0;n<this.matte.length;n++){var o=(t=n,e=this.width,void 0,void 0,[Math.floor(t/e),t%e]),a=o[1];r[o[0]][a]=this.matte[n]==c.Foreground?1:0}return r},t.UpdateMatte=function(t,e,r){for(var n=o.HashItems(r,function(t){return t}),i=0;i<t.length;i++)if(e[i]==c.Unknown){var a=n.ContainsKey(i);t[i]=a?c.Foreground:c.Background}},t.SegregatePixels=function(t,e,r,n,i,o){for(var a=[],s=[],u=0;u<t.length;u++){var h=t[u];e[u]==c.Foreground?a.push(h):s.push(h)}return[a,s]},t.LabelPixels=function(t,e,r,n,i,a,s){for(var u=n.clusters.length,h=i.clusters.length,f=o.Fill(u,0),p=o.Fill(h,0),d=function(t){for(var e=-Number.MAX_SAFE_INTEGER,r=0,n=0;n<t.length;n++){var i=t[n];i>e&&(r=n,e=i)}return r},g=0;g<e;g++)for(var v=0;v<r;v++){var m=l(g,v,r),y=t[m]==c.Foreground,M=a[m];if(y){var b=d(n.Predict(M).likelihoods);f[b]++,s[m]=0+b}else{var x=d(i.Predict(M).likelihoods);p[x]++,s[m]=u+x}}return[o.Range(0,u),f,o.Range(u,u+h),p]},t.GeneratePixel2PixelGraph=function(t,e,r,n,o){for(var a=s.isV3(t[0]),c=r*e,h=0;h<c;h++)n.CreateNode();for(var f=[[0,-1],[-1,0],[0,1],[1,0]],p=f.map(function(t){return o/Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))}),d=function(t,n,i){var o=f[i],a=t+o[0],s=n+o[1];return[function(t,e,r,n){return t>=0&&t<n&&e>=0&&e<r}(a,s,e,r),a,s]},g=0,v=0,m=a?s.DiffNormSquare:function(t,e){return i.NormSquare(i.Sub(t,e))},y=1/r/2,M=0;M<r;M++){for(var b=0;b<e;b++){var x=t[l(M,b,e)];for(h=0;h<f.length;h++){var w=d(M,b,h),E=w[0],S=w[1],P=w[2];if(E)v+=m(x,t[l(S,P,e)]),g++}}u.progress.STEP.GrabcutPixelGraph.advance(y)}var C=.5/(v/g),k=-Number.MAX_SAFE_INTEGER;for(M=0;M<r;M++){for(b=0;b<e;b++){var G=l(M,b,e);for(h=0;h<f.length;h++){var I=d(M,b,h);E=I[0],S=I[1],P=I[2];if(E){var q=l(S,P,e),_=-C*m(t[G],t[q]),D=p[h]*Math.exp(_);isNaN(D)&&console.log({coeff:p,beta:C,exponent:_,capacity:D}),n.CreateEdge(G,q,D),k=D>k?D:k}}}u.progress.STEP.GrabcutPixelGraph.advance(y)}return console.log("Pixel to pixel maximum capacity:"+k),[n,k]},t.InitSourceAndSink=function(t,e,r){for(var n=t.CreateNode(),i=t.CreateNode(),o=0;o<r;o++)for(var a=0;a<e;a++){var s=l(o,a,e);t.CreateEdge(n,s,0)}for(o=0;o<r;o++)for(a=0;a<e;a++){s=l(o,a,e);t.CreateEdge(s,i,0)}return[n,i]},t.UpdateSourceAndSink=function(e,r,n,i,o,a,s,u,h,l){for(var f=a*s,p=0;p<f;p++)switch(u[p]){case c.Foreground:e.UpdateEdge(h,p,r),e.UpdateEdge(p,l,0);break;case c.Background:e.UpdateEdge(h,p,0),e.UpdateEdge(p,l,r);break;case c.Unknown:var d=o[p],g=t.GetTLinkWeight(i,d),v=t.GetTLinkWeight(n,d);e.UpdateEdge(h,p,g),e.UpdateEdge(p,l,v)}},t.GetTLinkWeight=function(t,e){var r=t.Predict(e).TotalLikelihood(),n=-Math.log(r);return isNaN(n)?(console.log({gmm:t,res:n,pixel:e,gmmResult:r}),0):n},t}();function l(t,e,r){return t*r+e}e.GrabCut=h}),define("Progress",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.progress=void 0;var r=function(){function t(t){this.total=t,this.maxIterations=1,this.currIterations=0}return t.prototype.reset=function(t){return void 0===t&&(t=1),this.maxIterations=t,this.currIterations=0,this.maxIterations*this.total},t.prototype.advance=function(t){return void 0===t&&(t=1),this.currIterations<this.maxIterations?(t=Math.min(this.maxIterations-this.currIterations,t),this.currIterations+=t,e.progress.onAdvanced(this.total*t),this.total):0},t.prototype.advanceTo=function(t){if(this.currIterations<this.maxIterations){var r=(Math.min(this.maxIterations,Math.floor(this.currIterations+1))-this.currIterations)*t;return this.currIterations+=r,e.progress.onAdvanced(this.total*r),this.total}return 0},t.prototype.advanceMax=function(){if(this.currIterations<this.maxIterations){var t=this.maxIterations-this.currIterations;return this.currIterations=this.maxIterations,e.progress.onAdvanced(this.total*t),this.total*t}return 0},t}(),n=function(){function t(){this.STEP={PREPARE_TRIMAP:new r(200),PREPARE_IMGDATA:new r(425),KMeans:new r(711),Points2GMM:new r(825),EMLikelihoodEval:new r(600),EMRespSum:new r(79),EMCovCal:new r(110),GrabcutPixelGraph:new r(6138),GrabcutGMMRecomputation:new r(2474),GrabcutGraphSourceSinkUpdate:new r(1217),GrabcutGraphFlowReset:new r(54),GrabcutGraphMaxFlow:new r(8e3),GrabcutGraphCut:new r(350),GetAlphaMask:new r(90)}}return t.prototype.reset=function(t,e){this.workerScope=t,this.total=0,this.current=0,this.stopped=!1;var r=this.STEP;this.total+=r.PREPARE_TRIMAP.reset(),this.total+=r.PREPARE_IMGDATA.reset(),this.total+=r.KMeans.reset(2),this.total+=r.Points2GMM.reset(2);var n=20;this.total+=r.EMLikelihoodEval.reset(n),this.total+=r.EMRespSum.reset(n),this.total+=r.EMCovCal.reset(n),this.total+=r.GrabcutPixelGraph.reset(),n=e.maxIterations,this.total+=r.GrabcutGMMRecomputation.reset(n),this.total+=r.GrabcutGraphSourceSinkUpdate.reset(n),this.total+=r.GrabcutGraphFlowReset.reset(n),this.total+=r.GrabcutGraphMaxFlow.reset(n),this.total+=r.GrabcutGraphCut.reset(n),this.total+=r.GetAlphaMask.reset()},t.prototype.onAdvanced=function(t){if(this.stopped)throw new Error("cancelled");this.current+=t,this.workerScope.postMessage({type:"progress",progress:this.current,total:this.total})},t.prototype.stop=function(){this.stopped=!0,this.workerScope&&this.workerScope.postMessage({type:"cancelled"})},t}();e.progress=new n}),define("BKGraph",["require","exports","Collections/Dictionary","Collections/Queue","Utility","Progress"],function(t,e,r,n,i,o){"use strict";var a;Object.defineProperty(e,"__esModule",{value:!0}),e.BKMaxflow=e.BKNetwork=e.TreeFlag=void 0,function(t){t[t.Free=0]="Free",t[t.S=1]="S",t[t.T=2]="T"}(a=e.TreeFlag||(e.TreeFlag={}));var s=function(){return function(t,e,r,n){this.cap=r,this.flow=0,this.to=e,this.from=t,this.ind=n}}(),u=function(){return function(){this.edgesOut=[],this.edgesIn=[]}}(),c=function(){function t(){this.nodes=[],this.edges=[],this.edgeList=[]}return t.prototype.CreateNode=function(){var t=this.nodes.length;return this.nodes.push(new u),this.edgeList.push(new r.ObjectDict),t},t.prototype.CreateEdge=function(t,e,r){if(isNaN(r))throw new Error("capacity cannot be NaN");if(!isFinite(r))throw new Error("Infinite capacity");var n=this.edges.length,i=new s(t,e,r,n);return this.edges.push(i),this.nodes[t].edgesOut.push(i),this.nodes[e].edgesIn.push(i),this.edgeList[t].Set(e,i),n},t.prototype.UpdateEdge=function(t,e,r){this.edgeList[t].Get(e).cap=r},t.prototype.ResetFlow=function(){for(var t=this.edges,e=0;e<t.length;e++)t[e].flow=0},t.prototype.Clone=function(){for(var e=new t,r=0;r<this.nodes.length;r++)e.CreateNode();var n=this.edges;for(r=0;r<n.length;r++){var i=n[r],o=e.CreateEdge(i.from,i.to,i.cap);e.edges[o].flow=i.flow}return e},t}();e.BKNetwork=c;var h=-1;function l(t,e,r,n,i,o){for(;e.Count()>0;){var s=e.Peek(),u=r[s],c=t[s];if(u==a.S)for(var h=c.edgesOut,l=o[s];l<h.length;l++){if(!((p=h[l]).flow>=p.cap)){if(r[d=p.to]==a.T)return p;r[d]==a.Free&&(r[d]=u,n[d]=s,i[d]=p,e.Enqueue(d)),o[s]=l}}else{var f=c.edgesIn;for(l=o[s];l<f.length;l++){var p;if(!((p=f[l]).flow>=p.cap)){var d;if(r[d=p.from]==a.S)return p;r[d]==a.Free&&(r[d]=u,n[d]=s,i[d]=p,e.Enqueue(d)),o[s]=l}}}e.Dequeue(),o[s]=0}return null}function f(t,e,r,n){for(var i=r.cap-r.flow,o=r.from;o!=t;){var a=n[o];i=Math.min(i,a.cap-a.flow),o=a.from}for(var s=r.to;s!=e;){a=n[s];i=Math.min(i,a.cap-a.flow),s=a.to}return i}function p(t,e,r,n,i,o,a){n.flow+=t;for(var s=n.from;s!=e;){(c=i[s]).flow+=t,c.cap<=c.flow&&(a[s]=h,o.push(s)),s=c.from}for(var u=n.to;u!=r;){var c;(c=i[u]).flow+=t,c.cap<=c.flow&&(a[u]=h,o.push(u)),u=c.to}}function d(t,e,r,n){for(var i=t;i!=e;){if(r[i]==h)return!1;i=n[i].from}return!0}function g(t,e,r,n){for(var i=t;i!=e;){if(r[i]==h)return!1;i=n[i].to}return!0}function v(t,e,r,n,i,o,s,u){for(;e.length>0;){for(var c=e.pop(),l=t[c],f=r[c],p=f==a.S,v=!1,m=p?l.edgesIn:l.edgesOut,y=0;y<m.length;y++){var M=m[y],b=p?M.from:M.to,x=M.cap>M.flow,w=r[b]==f;if(x&&w)if(p?d(M.from,s,n,i):g(M.to,u,n,i)){v=!0,n[c]=b,i[c]=M;break}}if(!v){if(p){var E=l.edgesIn;for(y=0;y<E.length;y++){(M=E[y]).flow<M.cap&&r[M.from]==f&&(o.Contains(M.from)||o.Enqueue(M.from))}var S=l.edgesOut;for(y=0;y<S.length;y++){r[(M=S[y]).to]==f&&n[M.to]==c&&(e.push(M.to),n[M.to]=h)}}else{for(S=l.edgesOut,y=0;y<S.length;y++){(M=S[y]).flow<M.cap&&r[M.to]==f&&(o.Contains(M.to)||o.Enqueue(M.to))}for(E=l.edgesIn,y=0;y<E.length;y++){r[(M=E[y]).from]==f&&n[M.from]==c&&(e.push(M.from),n[M.from]=h)}}r[c]=a.Free,o.Contains(c)&&o.Remove(c)}}}e.BKMaxflow=function(t,e,r){var s=r.nodes,u=new n.LabelledCircularQueue,c=i.Fill(s.length,0),d=new Uint8Array(s.length),g=i.Fill(s.length,h),m=i.Fill(s.length,null),y=[];u.Enqueue(t),u.Enqueue(e),d[t]=a.S,d[e]=a.T;for(var M=0;;){++M;var b=l(s,u,d,g,m,c);if(null==b)break;p(f(t,e,b,m),t,e,b,m,y,g),v(s,y,d,g,m,u,t,e),M%1e4==0&&o.progress.STEP.GrabcutGraphMaxFlow.advanceTo(.05)}console.log("max flow loop = "+M),o.progress.STEP.GrabcutGraphMaxFlow.advanceTo(1);return{GetMaxFlow:function(){return i.Sum(s[t].edgesOut.map(function(t){return t.flow}))},GetSourcePartition:function(){return Array.from(d).map(function(t,e){return[t,e]}).filter(function(t){return t[0]==a.S}).map(function(t){return t[1]})}}}}),define("ClusterGenerator",["require","exports","Utility","Matrix"],function(t,e,r,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UniformClusters=void 0,e.UniformClusters=function(t,e,i){for(var o=n.Scale(-1,e),a=e,s=r.FillObj(i,function(){return n.Clone(t)}),u=0;u<i;u++){var c=n.RandomFill(o,a);n.AddInPlace(s[u],c)}return s}}),define("DinicFlowSolver",["require","exports","Utility","Collections/Dictionary","Collections/Queue"],function(t,e,r,n,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DinicSolver=e.MinCut=e.DinicMaxFlow=e.DinicNetwork=e.GraphNode=e.Edge=void 0;var o=function(){return function(t,e,r,n){this.sink=e,this.source=t,this.capacity=r,this.flow=0,this.id=n}}();e.Edge=o;var a=function(){return function(t){this.id=t,this.edges=[]}}();e.GraphNode=a;var s=function(){function t(){this.edgeMap=[],this.nodeList=[],this.edgeList=[]}return t.prototype.CreateNode=function(){var t=this.nodeList.length;return this.nodeList.push(new a(t)),this.edgeMap.push(new n.ObjectDict),t},t.prototype.CreateEdge=function(t,e,r){var n=this.edgeList.length,i=new o(t,e,r,n),a=new o(e,t,0,n+1);return i.reverse=a.id,a.reverse=i.id,this.nodeList[t].edges.push(i),this.nodeList[e].edges.push(a),this.edgeList.push(i),this.edgeList.push(a),this.edgeMap[t].Set(e,n),n},t.prototype.ResetFlow=function(){for(var t=this.edgeList,e=0;e<t.length;e++)t[e].flow=0},t.prototype.UpdateEdge=function(t,e,r){var n=this.edgeMap[t].Get(e);this.edgeList[n].capacity=r},t.prototype.Clone=function(){for(var e=new t,r=0;r<this.nodeList.length;r++)e.CreateNode();var n=this.edgeList;for(r=0;r<n.length;r+=2){var i=n[r],o=n[r+1],a=e.CreateEdge(i.source,i.sink,i.capacity),s=e.edgeList[a],u=e.edgeList[a+1];s.flow=i.flow,u.flow=o.flow}return e},t}();e.DinicNetwork=s;var u=0,c=0,h=0;function l(t,e,n,o,a){u++,r.Memset(a,-1);var s=o.UpdateToken(),c=s[0],h=s[1],l=new i.CircularBufferQueue,f=new i.CircularBufferQueue;for(l.Enqueue(e),f.Enqueue(0),c[e]=h;l.Count()>0;){var p=l.Dequeue(),d=f.Dequeue();a[p]=d;for(var g=n[p].edges,v=d+1,m=0;m<g.length;m++){var y=g[m];y.capacity-y.flow>0&&c[y.sink]!=h&&(c[y.sink]=h,l.Enqueue(y.sink),f.Enqueue(v))}}return-1!=a[t]}function f(t,e,r,n,i,o,a){c++;var s=n.UpdateToken(),u=s[0],h=s[1];o[t]=-1,o[e]=-1;var l=[];for(l.push(e),u[e]=h;l.length>0;){var f=l[l.length-1];if(f==t)break;for(var p=r[f].edges,d=!1,g=a[f];g<p.length;g++){var v=p[g];if(i[f]<i[v.sink]&&v.capacity-v.flow>0&&u[v.sink]!=h){u[v.sink]=h,o[v.sink]=v.id,l.push(v.sink),d=!0;break}a[f]+=1}d||l.pop()}return o[t]>=0}function p(t,e,r,n){h++;for(var i=t,o=9007199254740991;i!=e;){var a=(s=r[n[i]]).capacity-s.flow;o=Math.min(o,a),i=s.source}for(i=t;i!=e;){var s,u=r[(s=r[n[i]]).reverse];s.flow+=o,u.flow-=o,i=s.source}}function d(t,e,i){u=0,c=0,h=0;for(var o=t.nodeList,a=t.edgeList,s=r.Fill(o.length,0),d=new n.VisitedArray(o.length),g=r.Fill(o.length,-1),v=!0,m=r.Fill(o.length,0);v;)if(v=l(i,e,o,d,s)){var y=!0;for(r.Memset(m,0);y;)(y=f(i,e,o,d,s,g,m))&&p(i,e,a,g)}return console.log("calls to levelGraph:"+u+"\ncalls to fPath:"+c+"\ncalls to augment:"+h),s}function g(t,e,n,o){var a=[],s=[],u=t.nodeList,c=r.Fill(u.length,!1),h=new i.CircularBufferQueue;for(h.Enqueue(e),c[e]=!0;h.Count()>0;){var l=h.Dequeue();s.push(l),u[l].edges.forEach(function(t){var e=t.sink;c[e]||(o[e]>=0?(c[e]=!0,h.Enqueue(e)):t.capacity>0&&a.push(t.id))})}return{nodeList:s,edgeIndices:a}}e.DinicMaxFlow=d,e.MinCut=g,e.DinicSolver=function(t,e,n){var i=d(n,t,e),o=g(n,t,0,i);return{GetMaxFlow:function(){var e=n.nodeList[t];return r.Sum(e.edges.map(function(t){return t.flow}))},GetSourcePartition:function(){return o.nodeList}}}}),define("geoms/Point",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Point=void 0;var r=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.set=function(t,e){this.x=t,this.y=e},t.interpolate=function(e,r,n,i){i=i||new t;var o=e.x-r.x,a=e.y-r.y;return i.set(r.x+o*n,r.y+a*n),i},t.distance=function(t,e){var r=t.x-e.x,n=t.y-e.y;return Math.sqrt(r*r+n*n)},t.polar=function(e,r,n){return n?(n.set(Math.cos(r)*e,Math.sin(r)*e),n):new t(Math.cos(r)*e,Math.sin(r)*e)},t.fromPIXIPoint=function(e,r){return r?(r.set(e.x,e.y),r):new t(e.x,e.y)},t.fromXY=function(e,r,n){return n?(n.set(e,r),n):new t(e,r)},t.prototype.clone=function(){return new t(this.x,this.y)},t.fromString=function(e,r){if(e){var n=e.split(",");if(2==n.length)return r?(r.set(parseFloat(n[0]),parseFloat(n[1])),r):new t(parseFloat(n[0]),parseFloat(n[1]))}return null},t.makeString=function(t,e){return t+","+e},t.prototype.sub=function(e,r){return r?(r.set(this.x-e.x,this.y-e.y),r):new t(this.x-e.x,this.y-e.y)},t.prototype.subXY=function(e,r,n){return n?(n.set(this.x-e,this.y-r),n):new t(this.x-e,this.y-r)},t.prototype.add=function(e,r){return r?(r.set(this.x+e.x,this.y+e.y),r):new t(this.x+e.x,this.y+e.y)},t.prototype.addXY=function(e,r,n){return n?(n.set(this.x+e,this.y+r),n):new t(this.x+e,this.y+r)},Object.defineProperty(t.prototype,"lengthSquared",{get:function(){return this.x*this.x+this.y*this.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.lengthSquared)},enumerable:!1,configurable:!0}),t.prototype.distanceTo=function(t){var e=t.x-this.x,r=t.y-this.y;return Math.sqrt(e*e+r*r)},t.prototype.normalize=function(t){void 0===t&&(t=1);var e=this.length;return 0==e?0:(this.scale(t/e),e)},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.scale=function(t){this.x*=t,this.y*=t},t.prototype.cross=function(e,r){var n=this.y*e.x,i=this.x*e.y;return r?(r.set(n-i,i-n),r):new t(n-i,i-n)},t.prototype.getNormal=function(e){return e?(e.set(-this.y,this.x),e):new t(-this.y,this.x)},t.prototype.rotate=function(t){var e=Math.cos(t),r=Math.sin(t),n=this.x,i=this.y;this.x=n*e-i*r,this.y=i*e+n*r},t.prototype.equalsXY=function(t,e){return this.x==t&&this.y==e},t.prototype.getPerpendicularDistance=function(t){return Math.abs(t.x-this.x)+Math.abs(t.y-this.y)},t.prototype.getPerpendicularDistanceFrom=function(t,e){return Math.abs(t-this.x)+Math.abs(e-this.y)},Object.defineProperty(t.prototype,"vertical",{get:function(){return 0==this.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"horizontal",{get:function(){return 0==this.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"verticalOrHorizontal",{get:function(){return 0==this.x||0==this.y},enumerable:!1,configurable:!0}),t.prototype.equals=function(t){return t.x==this.x&&t.y==this.y},t}();e.Point=r}),define("geoms/Rectangle",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Rectangle=void 0;var r=function(){function t(t,e,r,n){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e,this.width=r,this.height=n}return Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),t.prototype.contains=function(t,e){return t>=this.x&&e>=this.y&&t<this.right&&e<this.bottom},t.prototype.containsPoint=function(t){return this.contains(t.x,t.y)},t.prototype.containsRectangle=function(t){return t.x>=this.x&&t.y>=this.y&&t.right<=this.right&&t.bottom<=this.bottom},t.prototype.intersects=function(t){return!(t.right<=this.x||t.bottom<=this.y||t.x>=this.right||t.y>=this.bottom)},t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.equals=function(t){return t&&t.x==this.x&&t.y==this.y&&t.width==this.width&&t.height==this.height},t.prototype.toString=function(){return t.makeString(this.x,this.y,this.width,this.height)},t.makeString=function(t,e,r,n){return t+","+e+","+r+","+n},t.fromString=function(e,r){var n=e.split(",");return 4==n.length?(r?(r.x=parseFloat(n[0]),r.y=parseFloat(n[1]),r.width=parseFloat(n[2]),r.height=parseFloat(n[3])):r=new t(parseFloat(n[0]),parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3])),r):null},t}();e.Rectangle=r}),define("geoms/Line",["require","exports","geoms/Rectangle","geoms/Point"],function(t,e,r,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Line=void 0;var i=function(){function t(t,e,r){this._point1=t,this._point2=e,this._finite=r}return Object.defineProperty(t.prototype,"point1",{get:function(){return this._point1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"point2",{get:function(){return this._point2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vector",{get:function(){return this._vector||(this._vector=this._point2.sub(this._point1)),this._vector},enumerable:!1,configurable:!0}),t.prototype.clone=function(){return new t(this._point1,this._point2,this._finite)},Object.defineProperty(t.prototype,"finite",{get:function(){return this._finite},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return"Line[("+this._point1+"),("+this._point2+")]"},t.prototype.distanceTo=function(t){return Math.abs((this.vector.x*(this._point1.y-t.y)-this.vector.y*(this._point1.x-t.x))/this.vector.length)},t.prototype.projectionOf=function(t,e){void 0===e&&(e=!1);var r=new n.Point(t.x-this._point1.x,t.y-this._point1.y),i=this.vector.clone();i.normalize();var o=i.dot(r);i.scale(o);var a=this._point1.add(i);if(e&&this.finite)if(0==this.vector.x){if(a.y<Math.min(this._point1.y,this._point2.y)||a.y>Math.max(this._point1.y,this._point2.y))return null}else if(a.x<Math.min(this._point1.x,this._point2.x)||a.x>Math.max(this._point1.x,this._point2.x))return null;return a},t.prototype.normalize=function(t){var e=this.vector.normalize(t);return this._point2.x=this._point1.x+this.vector.x,this._point2.y=this._point1.y+this.vector.y,this._extent=null,e},Object.defineProperty(t.prototype,"extent",{get:function(){return this._extent||(this._extent=new r.Rectangle(Math.min(this._point1.x,this._point2.x),Math.min(this._point1.y,this._point2.y),Math.abs(this.vector.x),Math.abs(this.vector.y))),this._extent},enumerable:!1,configurable:!0}),t.prototype.getPerpendicularLine=function(e){return new t(e,new n.Point(e.x-this.vector.y,e.y+this.vector.x),!1)},t.prototype.intersectsRectangle=function(t){if(t.containsPoint(this._point1)||t.containsPoint(this._point2))return!0;if(!this.extent.intersects(t))return!1;if(0==this.vector.x||0==this.vector.y)return!1;var e=this.vector.y/this.vector.x,r=this._point1.y-e*this._point1.x;return(e*this.extent.left-this.extent.top+r)*(e*this.extent.right-this.extent.bottom+r)<0||(e*this.extent.right-this.extent.top+r)*(e*this.extent.left-this.extent.bottom+r)<0},t.prototype.getX=function(t){if(0==this.vector.y)return Number.NaN;if(this.finite){if(t>this._point1.y&&t>this._point2.y)return Number.NaN;if(t<this._point1.y&&t<this._point2.y)return Number.NaN}return this._point1.x+(t-this._point1.y)*this.vector.x/this.vector.y},t.prototype.getY=function(t){if(0==this.vector.x)return Number.NaN;if(this.finite){if(t>this._point1.x&&t>this._point2.x)return Number.NaN;if(t<this._point1.x&&t<this._point2.x)return Number.NaN}return this._point1.y+(t-this._point1.x)*this.vector.y/this.vector.x},t.prototype.isPointOnRight=function(t){if(t.equals(this._point1))return!1;var e=new n.Point(t.x-this._point1.x,t.y-this._point1.y);return this.vector.getNormal().dot(e)>0},t.prototype.isPointOnLeft=function(t){if(t.equals(this._point1))return!1;var e=new n.Point(t.x-this._point1.x,t.y-this._point1.y);return this.vector.getNormal().dot(e)<0},t.prototype.arePointsOnSameSide=function(t,e){var r=this.vector.getNormal(),n=t.sub(this._point1),i=e.sub(this._point1);return r.dot(n)*r.dot(i)>0},t.prototype.markDirty=function(){this._vector=null,this._extent=null},t}();e.Line=i}),define("ImageUtil",["require","exports","Matrix","Utility"],function(t,e,r,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ImgData2URL=e.ApplyAlphaMaskToImgData=e.CreateBWImage=e.Apply2DConvolution=e.FeatherMask=e.ApplyAlphaMask=e.ImgData2_1DMat=e.Trimap2BW=e.EmptyImage=e.Temp2DCanvas=e.RGBA=void 0;var i=function(){function t(t,e,r,n){this.red=t,this.green=e,this.blue=r,this.alpha=n}return t.prototype.Equals=function(t){return this.red==t.red&&this.green==t.green&&this.blue==t.blue&&this.alpha==t.alpha},t.prototype.EqualsExcludeAlpha=function(t){return this.red==t.red&&this.green==t.green&&this.blue==t.blue},t.prototype.CSSValue=function(){return"rgba("+this.red+","+this.green+","+this.blue+","+this.alpha/255+")"},t}();e.RGBA=i;var o=function(){function t(t,e){var r=document.createElement("canvas");r.width=t,r.height=e;var n=r.getContext("2d");this.canvas=r,this.hDC=n,this.width=t,this.height=e}return t.prototype.GetHDC=function(){return this.hDC},t.prototype.GetImageData=function(){return this.hDC.getImageData(0,0,this.width,this.height)},t.prototype.SetImageData=function(t){return this.hDC.putImageData(t,0,0),this.canvas.toDataURL()},t}();e.Temp2DCanvas=o;var a=null;function s(t,e,r,n,i,o,a,s,u,c){for(var h=0,l=0;l<a;l++){var f=t+l-u;if(!(f<0||f>=n))for(var p=0;p<s;p++){var d=e+p-c;d<0||d>=i||(h+=o[l][p]*r[f][d])}}return h}e.EmptyImage=function(){if(null!=a)return a;var t=new o(1,1);return a=t.SetImageData(t.GetImageData())},e.Trimap2BW=function(t){for(var e=[t[0].length,t.length],r=e[0],n=e[1],i=new o(r,n),a=i.GetImageData(),s=a.data,u=0;u<n;u++)for(var c=0;c<r;c++){var h=4*(u*r+c),l=122*t[u][c];s[h+0]=l,s[h+1]=l,s[h+2]=l,s[h+3]=255}return i.SetImageData(a)},e.ImgData2_1DMat=function(t){for(var e=t.width*t.height,i=n.FillObj(e,function(){return r.CreateMatrix(3,1)}),o=t.data,a=0;a<e;a++){var s=4*a,u=i[a];u[0][0]=o[s+0],u[1][0]=o[s+1],u[2][0]=o[s+2]}return i},e.ApplyAlphaMask=function(t,e){var r=[t.width,t.height],n=r[0],i=r[1],a=new o(n,i),s=a.GetImageData(),u=s.data;u.set(t.data);for(var c=0;c<i;c++)for(var h=0;h<n;h++)u[4*(n*c+h)+3]=255,e[c][h];return a.SetImageData(s)},e.FeatherMask=function(t,e){for(var i=[e[0].length,e.length],o=i[0],a=i[1],u=r.CreateMatrix(a,o),c=t*t,h=Math.floor(t/2),l=n.Fill2DObj(t,t,function(){return 1/c}),f=0;f<a;f++)for(var p=0;p<o;p++)e[f][p]<.1?u[f][p]=e[f][p]:u[f][p]=s(f,p,e,a,o,l,t,t,h,h);return u},e.Apply2DConvolution=function(t,e){for(var n=r.Dimensions(t),i=n[0],o=n[1],a=r.Dimensions(e),u=a[0],c=a[1],h=[Math.floor(u/2),Math.floor(c/2)],l=h[0],f=h[1],p=r.CreateMatrix(i,o),d=0;d<i;d++)for(var g=0;g<o;g++)p[d][g]=s(d,g,t,i,o,e,u,c,l,f);return null},e.CreateBWImage=function(t){for(var e=[t[0].length,t.length],r=e[0],n=e[1],i=new o(r,n),a=i.GetImageData(),s=a.data,u=0;u<n;u++)for(var c=0;c<r;c++){var h=4*(u*r+c),l=255*t[u][c];s[h+0]=l,s[h+1]=l,s[h+2]=l,s[h+3]=255}return i.SetImageData(a)},e.ApplyAlphaMaskToImgData=function(t,e){var r=[t.width,t.height],n=r[0],i=r[1],o=new ImageData(n,i),a=o.data;a.set(t.data);for(var s=0;s<i;s++)for(var u=0;u<n;u++)a[4*(n*s+u)+3]=255*e[s][u];return o};var u=function(){function t(t,e){this.cursor=0,this.littleEndian=!0,this.buffer=t,this.littleEndian=e,this.view=new DataView(t.buffer)}return t.prototype.Seek=function(t){this.cursor=t},t.prototype.Cursor=function(){return this.cursor},t.prototype.WriteInt=function(t){this.view.setInt32(this.cursor,t,this.littleEndian),this.cursor+=4},t.prototype.WriteShort=function(t){this.view.setInt16(this.cursor,t,this.littleEndian),this.cursor+=2},t.prototype.WriteByte=function(t){this.view.setUint8(this.cursor,t),this.cursor+=1},t.prototype.BlockCopyArray=function(t){this.buffer.set(t,this.cursor),this.cursor+=t.length},t.prototype.GetBuffer=function(){return this.buffer},t}();e.ImgData2URL=function(t){var e=[t.width,t.height],r=e[0],n=e[1],i=r*n*4,o=i+108+14,a=new u(new Uint8Array(o),!0);a.WriteByte(66),a.WriteByte(77),a.WriteInt(o),a.WriteShort(0),a.WriteShort(0),a.WriteInt(122),a.WriteInt(108),a.WriteInt(r),a.WriteInt(-n),a.WriteShort(1),a.WriteShort(32),a.WriteInt(3),a.WriteInt(i),a.WriteInt(2808),a.WriteInt(2808),a.WriteInt(0),a.WriteInt(0),a.WriteInt(16711680),a.WriteInt(65280),a.WriteInt(255),a.WriteInt(4278190080),a.WriteInt(1);for(var s=0;s<36;s++)a.WriteByte(0);a.WriteInt(0),a.WriteInt(0),a.WriteInt(0),a.BlockCopyArray(t.data);var c=a.GetBuffer();for(s=122;s<c.length;s+=4){var h=c[s];c[s]=c[s+2],c[s+2]=h}var l=new Blob([c.buffer],{type:"image/bmp"});return URL.createObjectURL(l)}}),define("GrabCutWorker",["require","exports","geoms/Line","geoms/Point","geoms/Rectangle","GrabCut","ImageUtil","Progress","Utility"],function(t,e,r,n,i,o,a,s,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.init=void 0;var c=function(){function t(t,e,r,n){this.x=t,this.y=e,this.w=r,this.h=n,this.right=this.x+this.w,this.bottom=this.y+this.h}return t.prototype.contains=function(t,e){return t>=this.x&&t<this.right&&e>=this.y&&e<this.bottom},t}();function h(t,e,a,s){s.reverse(),s.forEach(function(t){var e;t.lines=[];for(var o,a=t.thickness/2+1,s=0,u=t.points;s<u.length;s++){var c=u[s],h=new n.Point(c.x,c.y);e&&t.lines.push(new r.Line(e,h,!0)),e=h,o?(o.x=Math.min(o.x,c.x-a),o.y=Math.min(o.y,c.y-a),o.width=Math.max(o.width,c.x+a-o.x),o.height=Math.max(o.height,c.y+a-o.y)):o=new i.Rectangle(c.x-a,c.y-a,2*a,2*a)}t.hitRect=o});for(var c=u.Fill2DObj(e,t,function(){return o.Trimap.Unknown}),h=0;h<e;h++)for(var f=0;f<t;f++){var p=l(s,f,h);p?c[h][f]="foreground"==p?o.Trimap.Foreground:o.Trimap.Background:a.contains(f,h)||(c[h][f]=o.Trimap.Background)}return c}function l(t,e,r){var i=new n.Point(e,r),o=t.find(function(t){return t.hitRect.contains(e,r)&&function(t,e,r){return!!t.find(function(t){return!!(t.projectionOf(r,!0)&&t.distanceTo(r)<=e)||(n.Point.distance(t.point1,r)<=e||n.Point.distance(t.point2,r)<=e)})}(t.lines,t.thickness/2,i)});return o?o.mode:""}e.init=function(t){t.onmessage=function(e){var r=e.data;if(console.log("receive grabcut command: ",r),"grabcut"==r.type)try{s.progress.reset(t,r.options);var n={width:r.width,height:r.height},i=new c(r.rect.x,r.rect.y,r.rect.w,r.rect.h);console.time("createTrimap");var u=h(n.width,n.height,i,r.lines);console.timeEnd("createTrimap");var l=new o.GrabCut(a.ImgData2_1DMat(r.imageData),n.width,n.height);l.SetTrimap(u,n.width,n.height),l.BeginCrop(r.options),console.time("GetAlphaMask");var f=a.FeatherMask(r.options.featherSize,l.GetAlphaMask());console.timeEnd("GetAlphaMask"),s.progress.STEP.GetAlphaMask.advance(),t.postMessage({type:"alphaMask",alphaMask:f})}catch(t){console.error("grabcut error: ",t)}else"cancel"==r.type&&s.progress.stop()},t.postMessage({type:"loaded"})}});require(["GrabCutWorker"],function(worker){worker.init(workerScope)});